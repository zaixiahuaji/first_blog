{"openapi":"3.0.0","paths":{"/api":{"get":{"operationId":"AppController_getHello","parameters":[],"responses":{"200":{"description":""}},"tags":["App"]}},"/api/categories":{"get":{"operationId":"CategoriesController_findActive","parameters":[],"responses":{"200":{"description":"类别列表"}},"summary":"获取启用的类别列表（按 sortOrder 排序）","tags":["categories"]}},"/api/admin/categories":{"get":{"operationId":"AdminCategoriesController_adminFindAll","parameters":[],"responses":{"200":{"description":"类别列表"},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"管理端：获取全部类别（含禁用）","tags":["admin.categories"]},"post":{"operationId":"AdminCategoriesController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateCategoryDto"}}}},"responses":{"201":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"管理端：创建类别（slug 不可修改）","tags":["admin.categories"]}},"/api/admin/categories/{id}":{"patch":{"operationId":"AdminCategoriesController_update","parameters":[{"name":"id","required":true,"in":"path","description":"Category UUID","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateCategoryDto"}}}},"responses":{"200":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"管理端：更新类别（不允许改 slug）","tags":["admin.categories"]},"delete":{"operationId":"AdminCategoriesController_remove","parameters":[{"name":"id","required":true,"in":"path","description":"Category UUID","schema":{"type":"string"}}],"responses":{"200":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"管理端：删除类别（文章迁移到 other）","tags":["admin.categories"]}},"/api/admin/categories/order":{"put":{"operationId":"AdminCategoriesController_reorder","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ReorderCategoriesDto"}}}},"responses":{"200":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"管理端：批量更新类别排序（orderedIds）","tags":["admin.categories"]}},"/api/posts":{"get":{"operationId":"PostsController_findAll","parameters":[{"name":"page","required":false,"in":"query","schema":{"minimum":1,"default":1,"type":"number"}},{"name":"limit","required":false,"in":"query","schema":{"minimum":1,"maximum":100,"default":20,"type":"number"}},{"name":"sort","required":false,"in":"query","schema":{"default":"createdAt","type":"string","enum":["createdAt","date","title"]}},{"name":"order","required":false,"in":"query","schema":{"default":"DESC","type":"string","enum":["ASC","DESC"]}},{"name":"category","required":false,"in":"query","description":"类别 slug（仅字母/数字/下划线，<=12，强制小写）","schema":{"maxLength":12,"example":"tech","type":"string"}},{"name":"q","required":false,"in":"query","description":"关键词搜索（ILIKE）","schema":{"type":"string"}},{"name":"vectorQ","required":false,"in":"query","description":"语义搜索文本（pgvector + OpenAI embeddings）","schema":{"type":"string"}}],"responses":{"200":{"description":"分页列表","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaginatedPostsDto"}}}}},"summary":"获取文章列表（支持分页/排序/过滤/关键词 q/语义 vectorQ）","tags":["posts"]},"post":{"operationId":"PostsController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreatePostDto"}}}},"responses":{"201":{"description":"创建成功","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostDto"}}}},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"创建文章（需要登录）","tags":["posts"]}},"/api/posts/stats/total":{"get":{"operationId":"PostsController_getTotal","parameters":[],"responses":{"200":{"description":"文章总数","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostsTotalDto"}}}}},"summary":"获取文章总数","tags":["posts"]}},"/api/posts/stats/categories":{"get":{"operationId":"PostsController_getCategoriesStats","parameters":[],"responses":{"200":{"description":"各类别文章数量（包含禁用类别，包含 0）","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostsCategoriesStatsDto"}}}}},"summary":"获取各类别文章数量","tags":["posts"]}},"/api/posts/{id}":{"get":{"operationId":"PostsController_findOne","parameters":[{"name":"id","required":true,"in":"path","description":"文章 UUID","schema":{"type":"string"}}],"responses":{"200":{"description":"文章详情","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostDto"}}}}},"summary":"获取文章详情","tags":["posts"]},"patch":{"operationId":"PostsController_update","parameters":[{"name":"id","required":true,"in":"path","description":"文章 UUID","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdatePostDto"}}}},"responses":{"200":{"description":"更新成功","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PostDto"}}}},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"更新文章（需要登录）","tags":["posts"]},"delete":{"operationId":"PostsController_remove","parameters":[{"name":"id","required":true,"in":"path","description":"文章 UUID","schema":{"type":"string"}}],"responses":{"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"删除文章（需要登录）","tags":["posts"]}},"/api/auth/login":{"post":{"operationId":"AuthController_login","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginDto"}}}},"responses":{"200":{"description":"登录成功返回 JWT access_token（用于 Authorization: Bearer <token>）"}},"summary":"登录（用户名），返回 access_token","tags":["auth"]}},"/api/auth/register":{"post":{"operationId":"AuthController_register","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterDto"}}}},"responses":{"201":{"description":"注册成功返回基本用户信息"}},"summary":"注册账号（用户名+邀请码+密码，角色由邀请码决定）","tags":["auth"]}},"/api/super-admin/users":{"get":{"operationId":"SuperAdminUsersController_findAll","parameters":[],"responses":{"200":{"description":"账号列表"},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"super_admin：获取所有 user/admin 账号","tags":["super-admin.users"]},"post":{"operationId":"SuperAdminUsersController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateManagedUserDto"}}}},"responses":{"201":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"super_admin：创建 user/admin 账号","tags":["super-admin.users"]}},"/api/super-admin/users/{id}":{"patch":{"operationId":"SuperAdminUsersController_updateRole","parameters":[{"name":"id","required":true,"in":"path","description":"User UUID","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateManagedUserRoleDto"}}}},"responses":{"200":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"super_admin：修改账号角色（仅 user/admin）","tags":["super-admin.users"]},"delete":{"operationId":"SuperAdminUsersController_remove","parameters":[{"name":"id","required":true,"in":"path","description":"User UUID","schema":{"type":"string"}}],"responses":{"200":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"super_admin：删除 user/admin 账号","tags":["super-admin.users"]}},"/api/super-admin/invite-codes":{"get":{"operationId":"SuperAdminInviteCodesController_list","parameters":[{"name":"role","required":true,"in":"query","schema":{"type":"string","enum":["user","admin"]}}],"responses":{"200":{"description":"邀请码列表"},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"super_admin：获取邀请码列表（按角色）","tags":["super-admin.invite-codes"]},"post":{"operationId":"SuperAdminInviteCodesController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateInviteCodeDto"}}}},"responses":{"201":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"super_admin：创建邀请码（user/admin）","tags":["super-admin.invite-codes"]}},"/api/super-admin/invite-codes/{code}":{"patch":{"operationId":"SuperAdminInviteCodesController_update","parameters":[{"name":"code","required":true,"in":"path","description":"Invite code (XXXX-XXXX)","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateInviteCodeDto"}}}},"responses":{"200":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"super_admin：更新邀请码启用状态","tags":["super-admin.invite-codes"]},"delete":{"operationId":"SuperAdminInviteCodesController_remove","parameters":[{"name":"code","required":true,"in":"path","description":"Invite code (XXXX-XXXX)","schema":{"type":"string"}}],"responses":{"200":{"description":""},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"super_admin：删除邀请码","tags":["super-admin.invite-codes"]}},"/api/admin/media/images":{"post":{"operationId":"AdminMediaController_uploadImage","parameters":[],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"type":"object","properties":{"file":{"type":"string","format":"binary"},"alt":{"type":"string"}},"required":["file"]}}}},"responses":{"200":{"description":"上传成功","content":{"application/json":{"schema":{"example":{"url":"/uploads/images/2025/12/27/xxxx.webp","key":"images/2025/12/27/xxxx.webp"}}}}},"401":{"description":"未登录或 token 无效"}},"security":[{"BearerAuth":[]}],"summary":"管理端：上传图片","tags":["admin.media"]}}},"info":{"title":"Personal Blog API","description":"个人博客 API 文档","version":"1.0","contact":{}},"tags":[{"name":"blog","description":""}],"servers":[],"components":{"securitySchemes":{"BearerAuth":{"scheme":"bearer","bearerFormat":"JWT","type":"http","description":"请输入有效的 JWT Token"}},"schemas":{"CreateCategoryDto":{"type":"object","properties":{"slug":{"type":"string","example":"ai_notes","description":"唯一标识（仅字母/数字/下划线，<=12，强制小写）","maxLength":12},"name":{"type":"string","example":"AI 笔记","maxLength":50},"description":{"type":"string","example":"与 AI 相关的记录"},"color":{"type":"string","example":"#3355ff","description":"必须从主题色中选择","enum":["#ff8800","#e62e2e","#00a3cc","#aacc00","#9900ff","#ffaa00","#00cc7a","#3355ff","#ff00aa","#00aaaa","#6600cc","#cc3300"]},"sortOrder":{"type":"number","example":40,"description":"排序权重（越小越靠前）","minimum":0},"isActive":{"type":"boolean","example":true,"description":"是否启用"}},"required":["slug","name","color"]},"UpdateCategoryDto":{"type":"object","properties":{"name":{"type":"string","example":"AI 笔记","maxLength":50},"description":{"type":"object","example":"与 AI 相关的记录"},"color":{"type":"string","example":"#3355ff","description":"必须从主题色中选择","enum":["#ff8800","#e62e2e","#00a3cc","#aacc00","#9900ff","#ffaa00","#00cc7a","#3355ff","#ff00aa","#00aaaa","#6600cc","#cc3300"]},"sortOrder":{"type":"number","example":40,"description":"排序权重（越小越靠前）","minimum":0},"isActive":{"type":"boolean","example":true,"description":"是否启用"}}},"ReorderCategoriesDto":{"type":"object","properties":{"orderedIds":{"description":"按目标顺序提交的 Category id 列表（后端按顺序重算 sortOrder）","example":["uuid-tech","uuid-music","uuid-visuals"],"type":"array","items":{"type":"string"}}},"required":["orderedIds"]},"PostDto":{"type":"object","properties":{"id":{"type":"string","example":"uuid"},"username":{"type":"string","example":"admin","maxLength":12},"title":{"type":"string","example":"模拟复兴","maxLength":255},"category":{"type":"string","example":"tech","description":"类别 slug","maxLength":12},"date":{"type":"string","example":"2023-11-05","maxLength":32},"excerpt":{"type":"string","example":"摘要..."},"content":{"type":"string","example":"正文..."},"createdAt":{"format":"date-time","type":"string"},"updatedAt":{"format":"date-time","type":"string"}},"required":["id","username","title","category","date","excerpt","content","createdAt","updatedAt"]},"PaginatedPostsDto":{"type":"object","properties":{"items":{"description":"文章列表","type":"array","items":{"$ref":"#/components/schemas/PostDto"}},"total":{"type":"number","example":123,"description":"总数"},"page":{"type":"number","example":1,"description":"页码（从 1 开始）"},"limit":{"type":"number","example":20,"description":"每页条数"}},"required":["items","total","page","limit"]},"PostsTotalDto":{"type":"object","properties":{"total":{"type":"number","example":123,"description":"文章总数"}},"required":["total"]},"PostsCategoryStatsItemDto":{"type":"object","properties":{"id":{"type":"string","example":"uuid","description":"类别 UUID"},"slug":{"type":"string","example":"tech","description":"类别 slug"},"name":{"type":"string","example":"技术","description":"类别显示名"},"color":{"type":"string","example":"#ff8800","description":"主题色"},"sortOrder":{"type":"number","example":10,"description":"排序权重（越小越靠前）"},"isActive":{"type":"boolean","example":true,"description":"是否启用"},"isSystem":{"type":"boolean","example":true,"description":"是否系统内置"},"count":{"type":"number","example":42,"description":"该类别文章数量（含 0）"}},"required":["id","slug","name","color","sortOrder","isActive","isSystem","count"]},"PostsCategoriesStatsDto":{"type":"object","properties":{"categories":{"description":"各类别文章数量（包含禁用类别，包含 0）","type":"array","items":{"$ref":"#/components/schemas/PostsCategoryStatsItemDto"}}},"required":["categories"]},"CreatePostDto":{"type":"object","properties":{"title":{"type":"string","example":"模拟复兴","maxLength":255},"category":{"type":"string","example":"tech","description":"类别 slug（仅字母/数字/下划线，<=12，强制小写）","maxLength":12},"date":{"type":"string","example":"2023-11-05","maxLength":32},"excerpt":{"type":"string","example":"摘要...","description":"列表页短摘要"},"content":{"type":"string","example":"正文...","description":"文章正文内容"}},"required":["title","category","date","excerpt","content"]},"UpdatePostDto":{"type":"object","properties":{"title":{"type":"string","example":"模拟复兴（修订版）","maxLength":255},"category":{"type":"string","example":"tech","description":"类别 slug（仅字母/数字/下划线，<=12，强制小写）","maxLength":12},"date":{"type":"string","example":"2023-11-06","maxLength":32},"excerpt":{"type":"string","example":"摘要（更新）..."},"content":{"type":"string","example":"正文（更新）..."}}},"LoginDto":{"type":"object","properties":{"username":{"type":"string","example":"admin_user","description":"用户名","maxLength":12},"password":{"type":"string","example":"admin123"}},"required":["username","password"]},"RegisterDto":{"type":"object","properties":{"username":{"type":"string","example":"cool_user","description":"用户名唯一，中文/英文/数字/下划线","maxLength":12},"inviteCode":{"type":"string","example":"ABCD-1234","description":"邀请码必须为大写，格式 XXXX-XXXX","maxLength":9},"password":{"type":"string","example":"abc123","description":"仅字母和数字，长度 1-10","maxLength":10}},"required":["username","inviteCode","password"]},"CreateManagedUserDto":{"type":"object","properties":{"username":{"type":"string","example":"new_user","description":"用户名唯一，中文/英文/数字/下划线","maxLength":12},"password":{"type":"string","example":"abc123","description":"仅字母和数字，长度 1-10","maxLength":10},"role":{"type":"string","enum":["user","admin"]}},"required":["username","password","role"]},"UpdateManagedUserRoleDto":{"type":"object","properties":{"role":{"type":"string","enum":["user","admin"]}},"required":["role"]},"CreateInviteCodeDto":{"type":"object","properties":{"role":{"type":"string","enum":["user","admin"]},"code":{"type":"string","example":"ABCD-1234","description":"可选，手动指定邀请码（必须大写且包含 -）"},"enabled":{"type":"boolean","default":true}},"required":["role"]},"UpdateInviteCodeDto":{"type":"object","properties":{"enabled":{"type":"boolean"}},"required":["enabled"]}}}}